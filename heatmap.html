<!doctype html>
<html>
<head>
  <title>HeatMap des Mobilisations</title>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.css" />
  <style>
    .map {
      width:800px;
      height:600px;
    }
  </style>
</head>
<body>
  <div class="map">
    <noscript>
      This example requires javascript.
    </noscript>
  </div>

  <script src="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.js"></script>
  <script>
    (function () {
      var FEEDS = [
        'https://raw.githubusercontent.com/geographesESR/cartographie-des-mouvements-sociaux/master/autres.geojson',
        'https://raw.githubusercontent.com/geographesESR/cartographie-des-mouvements-sociaux/master/culture.geojson',
        'https://raw.githubusercontent.com/geographesESR/cartographie-des-mouvements-sociaux/master/education.geojson',
        'https://raw.githubusercontent.com/geographesESR/cartographie-des-mouvements-sociaux/master/esr.geojson',
        'https://raw.githubusercontent.com/geographesESR/cartographie-des-mouvements-sociaux/master/indus_energie.geojson',
        'https://raw.githubusercontent.com/geographesESR/cartographie-des-mouvements-sociaux/master/justice.geojson',
        'https://raw.githubusercontent.com/geographesESR/cartographie-des-mouvements-sociaux/master/multi.geojson',
        'https://raw.githubusercontent.com/geographesESR/cartographie-des-mouvements-sociaux/master/sante.geojson',
        'https://raw.githubusercontent.com/geographesESR/cartographie-des-mouvements-sociaux/master/securite.geojson',
        'https://raw.githubusercontent.com/geographesESR/cartographie-des-mouvements-sociaux/master/transport.geojson'
        ];
      var NOW = new Date();

      // create map
      var map = L.map(document.querySelector('.map'));
      // center in colorado
      map.setView([47, 2], 6);
      // add basemap
      L.tileLayer('https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
          /**
           * http://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer?f=pjson
           * copyrightText
           */
          attribution: 'Sources: Geographes ESR - Cartographie des mouvements sociaux'
          }).addTo(map);

      // add earthquake layer
      var earthquakes = L.geoJson([], {
        onEachFeature: function (feature, layer) {
          var props = feature.properties;

          layer.bindPopup('<a href="' + props.Source + '">' + props.Titre + '</a>');
        },
        pointToLayer: function (feature, latlng) {

          return L.circleMarker(latlng, {
            color: '#FF0000',
            radius: 1
          });
        }
      }).addTo(map);

      // load data asynchronously
      FEEDS.forEach(function(item, index, array) {
        var xhr = new XMLHttpRequest();
        xhr.onload = function () {
            var results = JSON.parse(xhr.responseText);
            earthquakes.addData(results);
        };
        xhr.open('GET', item, true);
        xhr.send();
      });
    })();
  </script>
</body>
</html>
